// –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞—á –û–ì–≠
const worksDatabase = {
    1: [
        {n:1, q:"–î–ª—è –æ–±—ä–µ–∫—Ç–æ–≤, —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –≤ —Ç–∞–±–ª–∏—Ü–µ, –æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ, –∫–∞–∫–∏–º–∏ —Ü–∏—Ñ—Ä–∞–º–∏ –æ–Ω–∏ –æ–±–æ–∑–Ω–∞—á–µ–Ω—ã –Ω–∞ –ø–ª–∞–Ω–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã.<br><strong>–û–±—ä–µ–∫—Ç—ã|–∫–æ—Ä–∏–¥–æ—Ä|–∫–ª–∞–¥–æ–≤–∞—è|—Å–∞–Ω—É–∑–µ–ª|–≥–æ—Å—Ç–∏–Ω–∞—è</strong><br><br><strong>–¶—ã—Ñ—Ä—ã</br></strong><img src='img/oge/1-plan.jpg' class='img-fluid mb-3' onclick='openImage(this.src)'>", a:"2316", type:"seq", topic:"–†–∞–±–æ—Ç–∞ —Å –ø–ª–∞–Ω–æ–º"},
        {n:2, q:"–ü–∞—Ä–∫–µ—Ç–Ω–∞—è –¥–æ—Å–∫–∞ 20√ó80 —Å–º, –≤ —É–ø–∞–∫–æ–≤–∫–µ 12 —à—Ç. –°–∫–æ–ª—å–∫–æ —É–ø–∞–∫–æ–≤–æ–∫ –Ω—É–∂–Ω–æ –¥–ª—è –ø–æ–ª–∞ –≤ –∫–æ—Ä–∏–¥–æ—Ä–µ?", a:"11", type:"num", topic:"–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏"},
        {n:3, q:"–ù–∞–π–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è 12.5 √ó 2 - 0.04", a:"24.96", type:"num", topic:"–ê—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞"},
        {n:4, q:"–í –∞–º—Ñ–∏—Ç–µ–∞—Ç—Ä–µ 24 —Ä—è–¥–∞, –ø—Ä–∏—á—ë–º –≤ –∫–∞–∂–¥–æ–º —Å–ª–µ–¥—É—é—â–µ–º —Ä—è–¥—É –Ω–∞ –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ —á–∏—Å–ª–æ –º–µ—Å—Ç –±–æ–ª—å—à–µ, —á–µ–º –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º. –í –ø—è—Ç–æ–º —Ä—è–¥—É 27 –º–µ—Å—Ç, –∞ –≤ —Å–µ–¥—å–º–æ–º —Ä—è–¥—É 31 –º–µ—Å—Ç–æ. –°–∫–æ–ª—å–∫–æ –º–µ—Å—Ç –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–º —Ä—è–¥—É?", a:"53", type:"num", topic:"–ê—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∏—è"},
        {n:5, q:"–ê–≤—Ç–æ–º–æ–±–∏–ª—å –ø—Ä–æ–µ—Ö–∞–ª 500 –∫–º. –ü–µ—Ä–≤—ã–µ 200 –∫–º –æ–Ω –µ—Ö–∞–ª —Å–æ —Å–∫–æ—Ä–æ—Å—Ç—å—é 80 –∫–º/—á, –∞ –æ—Å—Ç–∞–ª—å–Ω–æ–π –ø—É—Ç—å ‚Äî —Å–æ —Å–∫–æ—Ä–æ—Å—Ç—å—é 100 –∫–º/—á. –ù–∞–π–¥–∏—Ç–µ —Å—Ä–µ–¥–Ω—é—é —Å–∫–æ—Ä–æ—Å—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—è –Ω–∞ –≤—Å—ë–º –ø—É—Ç–∏.", a:"90", type:"num", topic:"–°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å"},
        {n:6, q:"–†–µ—à–∏—Ç–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ: 3x¬≤ - 5x - 2 = 0", a:"2; -1/3", type:"text", topic:"–ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è"},
        {n:7, q:"–ù–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–Ω–æ–π –ø—Ä—è–º–æ–π —Ç–æ—á–∫–∏ ùê¥, ùêµ, ùê∂ –∏ ùê∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —á–∏—Å–ª–∞–º 0,1032;‚àí0,031; ‚àí0,01 –∏ ‚àí0,104.<br><img src='img/oge/1–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç.jpg' class='img-fluid mb-3' onclick='openImage(this.src)'>", a:"1", type:"num", topic:"–†–∞–±–æ—Ç–∞ —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏"},
        {n:8, q:"–í –∫–æ—Ä–æ–±–∫–µ –ª–µ–∂–∞—Ç 20 –∫–∞—Ä—Ç–æ—á–µ–∫ —Å —á–∏—Å–ª–∞–º–∏ –æ—Ç 1 –¥–æ 20. –ö–∞–∫–æ–≤–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –≤—ã—Ç–∞—â–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É —Å —á–∏—Å–ª–æ–º, –∫—Ä–∞—Ç–Ω—ã–º 3?", a:"0.3", type:"num", topic:"–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å"},
        {n:9, q:"–ü–ª–æ—â–∞–¥—å –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞ —Ä–∞–≤–Ω–∞ 48 —Å–º¬≤, –∞ –æ–¥–Ω–∞ –∏–∑ –µ–≥–æ —Å—Ç–æ—Ä–æ–Ω –Ω–∞ 2 —Å–º –±–æ–ª—å—à–µ –¥—Ä—É–≥–æ–π. –ù–∞–π–¥–∏—Ç–µ –ø–µ—Ä–∏–º–µ—Ç—Ä –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞.", a:"28", type:"num", topic:"–ì–µ–æ–º–µ—Ç—Ä–∏—è"},
    ],
    2: [
        {n:1, q:"–î–∞—á–Ω—ã–π —É—á–∞—Å—Ç–æ–∫. –ö–∞–∫–∏–µ —Ü–∏—Ñ—Ä—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç: —è–±–ª–æ–Ω–∏‚ÄÉ—Ç–µ–ø–ª–∏—Ü–∞‚ÄÉ—Å–∞—Ä–∞–π‚ÄÉ–∂–∏–ª–æ–π –¥–æ–º<br><img src='img/oge/2-plan.jpg' class='img-fluid mb-3' onclick='openImage(this.src)'>", a:"3517", type:"seq", topic:"–†–∞–±–æ—Ç–∞ —Å –ø–ª–∞–Ω–æ–º"},
        {n:2, q:"–ü–ª–∏—Ç–∫–∞ 1√ó1 –º, –≤ —É–ø–∞–∫–æ–≤–∫–µ 8 —à—Ç. –°–∫–æ–ª—å–∫–æ —É–ø–∞–∫–æ–≤–æ–∫ –Ω–∞ –≤—Å–µ –¥–æ—Ä–æ–∂–∫–∏ –∏ –ø–ª–æ—â–∞–¥–∫—É –º–µ–∂–¥—É –≥–∞—Ä–∞–∂–æ–º –∏ —Å–∞—Ä–∞–µ–º?", a:"9", type:"num", topic:"–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏"},
        {n:3, q:"–†–µ—à–∏—Ç–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ: 2x - 7 = 3", a:"5", type:"num", topic:"–õ–∏–Ω–µ–π–Ω—ã–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è"},
        {n:4, q:"–í –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–∏ b‚ÇÅ = 3, q = 2. –ù–∞–π–¥–∏—Ç–µ b‚ÇÖ.", a:"48", type:"num", topic:"–ì–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∏—è"},
        {n:5, q:"–°–∫–æ–ª—å–∫–æ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç—Ä—ë—Ö–∑–Ω–∞—á–Ω—ã—Ö —á–∏—Å–µ–ª –º–æ–∂–Ω–æ —Å–æ—Å—Ç–∞–≤–∏—Ç—å –∏–∑ —Ü–∏—Ñ—Ä 1, 2, 3, 4 –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π?", a:"24", type:"num", topic:"–ö–æ–º–±–∏–Ω–∞—Ç–æ—Ä–∏–∫–∞"},
        {n:6, q:"–ù–∞–π–¥–∏—Ç–µ –∫–æ—Ä–Ω–∏ —É—Ä–∞–≤–Ω–µ–Ω–∏—è: x¬≤ - 9 = 0", a:"-3; 3", type:"text", topic:"–ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è"},
        {n:7, q:"–ù–∞ –≥—Ä–∞—Ñ–∏–∫–µ –ø–æ–∫–∞–∑–∞–Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—è. –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –ø—É—Ç—å –∑–∞ –ø–µ—Ä–≤—ã–µ 4 —á–∞—Å–∞.<br><img src='img/oge/2-graph.jpg' class='img-fluid mb-3' onclick='openImage(this.src)'>", a:"120", type:"num", topic:"–†–∞–±–æ—Ç–∞ —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏"},
        {n:8, q:"–í —É—Ä–Ω–µ 5 –±–µ–ª—ã—Ö –∏ 3 —á—ë—Ä–Ω—ã—Ö —à–∞—Ä–∞. –ö–∞–∫–æ–≤–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –≤—ã—Ç–∞—â–∏—Ç—å –±–µ–ª—ã–π —à–∞—Ä?", a:"5/8", type:"text", topic:"–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å"},
        {n:9, q:"–î–∏–∞–≥–æ–Ω–∞–ª—å –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞ —Ä–∞–≤–Ω–∞ 10 —Å–º, –∞ –æ–¥–Ω–∞ –∏–∑ —Å—Ç–æ—Ä–æ–Ω 6 —Å–º. –ù–∞–π–¥–∏—Ç–µ –ø–ª–æ—â–∞–¥—å.", a:"48", type:"num", topic:"–ì–µ–æ–º–µ—Ç—Ä–∏—è"},
    ]
};

// –ó–∞–ø–æ–ª–Ω—è–µ–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã 3-10
for (let i = 3; i <= 10; i++) {
    if (!worksDatabase[i]) worksDatabase[i] = [];
    // –ö–æ–ø–∏—Ä—É–µ–º –∑–∞–¥–∞—á–∏ –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–∞ 2 –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
    while (worksDatabase[i].length < 25) {
        const origTask = worksDatabase[2][worksDatabase[i].length] || {n: worksDatabase[i].length + 1, q:"–ó–∞–¥–∞–Ω–∏–µ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ", a:"?", type:"text", topic:"–¢–µ–º–∞"};
        worksDatabase[i].push({
            ...origTask,
            n: worksDatabase[i].length + 1,
            q: origTask.q.replace('–≤–∞—Ä–∏–∞–Ω—Ç 2', `–≤–∞—Ä–∏–∞–Ω—Ç ${i}`)
        });
    }
}

// === –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ===
let userState = {
    solved: {},        // {workId: {taskId: true/false}}
    currentWork: 1
};

// === –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ===
document.addEventListener('DOMContentLoaded', () => {
    initUserState();
    createWorkFilter();
    loadWork(userState.currentWork);
    updateStats();
    setupEventListeners();
});

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
function initUserState() {
    try {
        const saved = localStorage.getItem('oge2025_state');
        if (saved) {
            userState = JSON.parse(saved);
        }
        if (!userState.solved) {
            userState.solved = {};
        }
        console.log('User state loaded:', userState);
    } catch (e) {
        console.error('Error loading user state:', e);
        userState = { solved: {}, currentWork: 1 };
    }
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
function saveUserState() {
    try {
        localStorage.setItem('oge2025_state', JSON.stringify(userState));
        console.log('User state saved:', userState);
    } catch (e) {
        console.error('Error saving user state:', e);
    }
}

// –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞ —Ä–∞–±–æ—Ç
function createWorkFilter() {
    const container = document.getElementById('work-filter');
    if (!container) return;
    
    container.innerHTML = '';
    
    for (let i = 1; i <= 10; i++) {
        const btn = document.createElement('button');
        btn.className = 'oge-filter-btn';
        if (i === userState.currentWork) {
            btn.classList.add('active');
        }
        btn.innerHTML = `
            <i class="bi bi-journal-text"></i>
            <span>–í–∞—Ä–∏–∞–Ω—Ç ${i}</span>
        `;
        btn.dataset.work = i;
        btn.addEventListener('click', () => loadWork(i));
        container.appendChild(btn);
    }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã
function loadWork(workId) {
    userState.currentWork = workId;
    saveUserState();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
    document.querySelectorAll('.oge-filter-btn').forEach(btn => {
        btn.classList.remove('active');
        if (parseInt(btn.dataset.work) === workId) {
            btn.classList.add('active');
        }
    });
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–∞–±–æ—Ç–µ
    updateWorkInfo(workId);
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–¥–∞—á–∏
    const container = document.getElementById('work-container');
    if (!container) return;
    
    container.innerHTML = '';
    
    const tasks = worksDatabase[workId] || [];
    tasks.forEach(task => {
        const taskCard = createTaskCard(workId, task);
        container.appendChild(taskCard);
    });
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    updateStats();
    
    console.log(`Work ${workId} loaded with ${tasks.length} tasks`);
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–∞–±–æ—Ç–µ
function updateWorkInfo(workId) {
    const workInfo = document.getElementById('work-info');
    if (workInfo) {
        workInfo.innerHTML = `
            <h3>–í–∞—Ä–∏–∞–Ω—Ç ${workId}</h3>
            <p>25 –∑–∞–¥–∞–Ω–∏–π ‚Ä¢ –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: 235 –º–∏–Ω—É—Ç</p>
        `;
    }
}

// –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –∑–∞–¥–∞—á–∏
function createTaskCard(workId, task) {
    const taskId = `${workId}-${task.n}`;
    const isSolved = userState.solved[workId]?.[task.n];
    
    const taskCard = document.createElement('div');
    taskCard.className = 'oge-task-card';
    taskCard.id = `task-${taskId}`;
    
    taskCard.innerHTML = `
        <div class="oge-task-header">
            <div class="oge-task-topic">${task.topic || '–û–±—â–µ–µ'}</div>
            <div class="oge-task-number">–ó–∞–¥–∞–Ω–∏–µ ${task.n}</div>
            ${isSolved ? '<div class="oge-solved-badge"><i class="bi bi-check-circle-fill"></i> –†–µ—à–µ–Ω–æ</div>' : ''}
        </div>
        
        <div class="oge-task-question">
            ${task.q}
        </div>
        
        <div class="oge-answer-container">
            <div class="oge-answer-section">
                <input type="${task.type === 'num' ? 'number' : 'text'}" 
                       class="oge-answer-input" 
                       id="answer-${taskId}" 
                       placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –æ—Ç–≤–µ—Ç">
                <button class="oge-check-btn" data-task="${taskId}">
                    <i class="bi bi-check-circle"></i> –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
                </button>
            </div>
        </div>
        
        <div class="oge-task-actions" style="display: none;" id="actions-${taskId}">
            <button class="oge-hint-btn" data-task="${taskId}">
                <i class="bi bi-lightbulb"></i> –ü–æ–¥—Å–∫–∞–∑–∫–∞
            </button>
            <button class="oge-solution-btn" data-task="${taskId}">
                <i class="bi bi-journal-text"></i> –†–µ—à–µ–Ω–∏–µ
            </button>
            <button class="oge-answer-btn" data-task="${taskId}">
                <i class="bi bi-eye"></i> –û—Ç–≤–µ—Ç
            </button>
        </div>
        
        <div class="oge-feedback" id="feedback-${taskId}"></div>
        
        <div class="oge-solution" id="solution-${taskId}">
            <h4><i class="bi bi-pencil-square"></i> –†–µ—à–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è ${task.n}:</h4>
            <div class="solution-content">
                <p>–ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏.</p>
                <div class="alert alert-info">
                    <i class="bi bi-info-circle"></i> –î–ª—è —ç—Ç–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è –ø–æ–∫–∞ –Ω–µ—Ç –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è.
                </div>
            </div>
        </div>
    `;
    
    return taskCard;
}

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
function setupEventListeners() {
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Å–±—Ä–æ—Å–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
    const resetBtn = document.querySelector('.oge-reset-btn');
    if (resetBtn) {
        resetBtn.addEventListener('click', resetProgress);
    }
    
    // –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    document.addEventListener('click', (e) => {
        const target = e.target;
        
        // –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏
        if (target.closest('.oge-check-btn')) {
            const taskId = target.closest('.oge-check-btn').dataset.task;
            checkAnswer(taskId);
        }
        
        // –ö–Ω–æ–ø–∫–∞ –ø–æ–¥—Å–∫–∞–∑–∫–∏
        if (target.closest('.oge-hint-btn')) {
            const taskId = target.closest('.oge-hint-btn').dataset.task;
            showHint(taskId);
        }
        
        // –ö–Ω–æ–ø–∫–∞ —Ä–µ—à–µ–Ω–∏—è
        if (target.closest('.oge-solution-btn')) {
            const taskId = target.closest('.oge-solution-btn').dataset.task;
            toggleSolution(taskId);
        }
        
        // –ö–Ω–æ–ø–∫–∞ –æ—Ç–≤–µ—Ç–∞
        if (target.closest('.oge-answer-btn')) {
            const taskId = target.closest('.oge-answer-btn').dataset.task;
            showAnswer(taskId);
        }
        
        // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–º –æ—Ç–∫—Ä—ã—Ç–∏—è
        if (target.tagName === 'IMG' && target.onclick) {
            openImage(target.src);
        }
    });
    
    // Enter –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
    document.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && e.target.classList.contains('oge-answer-input')) {
            const taskId = e.target.id.replace('answer-', '');
            checkAnswer(taskId);
        }
    });
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–∞
function checkAnswer(taskId) {
    const [workId, taskNum] = taskId.split('-').map(Number);
    const input = document.getElementById(`answer-${taskId}`);
    const feedback = document.getElementById(`feedback-${taskId}`);
    const actions = document.getElementById(`actions-${taskId}`);
    const taskCard = document.getElementById(`task-${taskId}`);
    
    if (!input || !feedback) return;
    
    let userAnswer = input.value.trim();
    const task = worksDatabase[workId]?.[taskNum - 1];
    if (!task) {
        feedback.innerHTML = '<div class="incorrect-feedback">‚ùå –ó–∞–¥–∞—á–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</div>';
        feedback.className = 'oge-feedback incorrect';
        return;
    }
    
    const correctAnswer = task.a.toString();
    
    // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤
    const normalize = (ans) => {
        return ans.toLowerCase()
            .replace(/\s+/g, '')
            .replace(/,/g, '.')
            .replace(/;/g, ',')
            .replace(/[()]/g, '')
            .trim();
    };
    
    const normalizedUser = normalize(userAnswer);
    const normalizedCorrect = normalize(correctAnswer);
    
    let isCorrect = false;
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
    if (normalizedUser === normalizedCorrect) {
        isCorrect = true;
    } else {
        // –ü–æ–ø—ã—Ç–∫–∞ —á–∏—Å–ª–µ–Ω–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
        try {
            const userNum = parseFloat(normalizedUser.replace(',', '.'));
            const correctNum = parseFloat(normalizedCorrect.replace(',', '.'));
            if (!isNaN(userNum) && !isNaN(correctNum)) {
                isCorrect = Math.abs(userNum - correctNum) < 0.001;
            }
        } catch (e) {
            console.log('–ù–µ —É–¥–∞–ª–æ—Å—å —Å—Ä–∞–≤–Ω–∏—Ç—å —á–∏—Å–ª–µ–Ω–Ω–æ');
        }
    }
    
    if (isCorrect) {
        feedback.innerHTML = `
            <div class="correct-feedback">
                <i class="bi bi-check-circle-fill"></i>
                <strong>–ü—Ä–∞–≤–∏–ª—å–Ω–æ!</strong> –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!
                ${correctAnswer !== userAnswer ? `<br><small>(–í–∞—à –æ—Ç–≤–µ—Ç: ${userAnswer}, –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π: ${correctAnswer})</small>` : ''}
            </div>
        `;
        feedback.className = 'oge-feedback correct';
        
        // –ü–æ–º–µ—á–∞–µ–º –∫–∞–∫ —Ä–µ—à–µ–Ω–Ω–æ–µ
        markAsSolved(workId, taskNum, true);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –±–µ–π–¥–∂
        if (taskCard) {
            const header = taskCard.querySelector('.oge-task-header');
            const oldBadge = header.querySelector('.oge-solved-badge');
            if (oldBadge) oldBadge.remove();
            
            const solvedDiv = document.createElement('div');
            solvedDiv.className = 'oge-solved-badge';
            solvedDiv.innerHTML = '<i class="bi bi-check-circle-fill"></i> –†–µ—à–µ–Ω–æ';
            header.appendChild(solvedDiv);
            
            // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
            if (actions) actions.style.display = 'none';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
            taskCard.style.animation = 'ogePulse 0.5s ease';
            setTimeout(() => {
                taskCard.style.animation = '';
            }, 500);
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ—à–µ–Ω–∏–µ
        setTimeout(() => {
            toggleSolution(taskId, true);
        }, 500);
        
        // –û–ë–ù–û–í–õ–ï–ù–ò–ï: –£–±—Ä–∞–Ω–æ –ø–æ–∫–∞–∑ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è
        
    } else {
        feedback.innerHTML = `
            <div class="incorrect-feedback">
                <i class="bi bi-x-circle-fill"></i>
                <strong>–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ.</strong> –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑!
                <div class="hint-suggestion mt-2">
                    <small><i class="bi bi-lightbulb"></i> –í–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –ø–æ–¥—Å–∫–∞–∑–∫–æ–π –∏–ª–∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Ä–µ—à–µ–Ω–∏–µ</small>
                </div>
            </div>
        `;
        feedback.className = 'oge-feedback incorrect';
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
        if (actions) {
            actions.style.display = 'flex';
            actions.style.animation = 'ogeFadeIn 0.5s ease';
        }
        
        markAsSolved(workId, taskNum, false);
    }
    
    updateStats();
}

// –û—Ç–º–µ—Ç–∏—Ç—å –∑–∞–¥–∞—á—É –∫–∞–∫ —Ä–µ—à–µ–Ω–Ω—É—é
function markAsSolved(workId, taskNum, correct) {
    if (!userState.solved[workId]) userState.solved[workId] = {};
    userState.solved[workId][taskNum] = correct;
    saveUserState();
}

// –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É
function showHint(taskId) {
    const [workId, taskNum] = taskId.split('-');
    const hints = [
        "–í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—á–∏—Ç–∞–π—Ç–µ —É—Å–ª–æ–≤–∏–µ –∑–∞–¥–∞—á–∏",
        "–í—ã–ø–∏—à–∏—Ç–µ –≤—Å–µ –∏–∑–≤–µ—Å—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ",
        "–°–¥–µ–ª–∞–π—Ç–µ —á–µ—Ä—Ç—ë–∂ –∏–ª–∏ —Å—Ö–µ–º—É",
        "–†–∞–∑–±–µ–π—Ç–µ –∑–∞–¥–∞—á—É –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Å—Ç—ã—Ö —à–∞–≥–æ–≤",
        "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –µ–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è",
        "–í—Å–ø–æ–º–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É–ª—É –ø–æ —Ç–µ–º–µ",
        "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ä–µ—à–∏—Ç—å –∑–∞–¥–∞—á—É –æ—Ç –æ–±—Ä–∞—Ç–Ω–æ–≥–æ",
        "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –Ω–∞ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏"
    ];
    
    const randomHint = hints[Math.floor(Math.random() * hints.length)];
    
    // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    const modal = document.createElement('div');
    modal.className = 'oge-hint-modal';
    modal.innerHTML = `
        <div class="oge-hint-overlay" onclick="this.parentElement.remove()"></div>
        <div class="oge-hint-content">
            <div class="oge-hint-header">
                <h4><i class="bi bi-lightbulb-fill"></i> –ü–æ–¥—Å–∫–∞–∑–∫–∞ –∫ –∑–∞–¥–∞–Ω–∏—é ${taskNum}</h4>
                <button class="oge-close-hint" onclick="this.closest('.oge-hint-modal').remove()">√ó</button>
            </div>
            <div class="oge-hint-body">
                <div class="oge-hint-icon">
                    <i class="bi bi-lightbulb"></i>
                </div>
                <p class="oge-hint-text">${randomHint}</p>
                <div class="oge-hint-topic">
                    <small>–¢–µ–º–∞: ${worksDatabase[workId][taskNum-1]?.topic || '–û–±—â–∞—è'}</small>
                </div>
            </div>
            <div class="oge-hint-footer">
                <button class="oge-understand-btn" onclick="this.closest('.oge-hint-modal').remove()">
                    –ü–æ–Ω—è—Ç–Ω–æ
                </button>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    
    // –°—Ç–∏–ª–∏ –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    const style = document.createElement('style');
    style.textContent = `
        .oge-hint-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }
        .oge-understand-btn {
            background: linear-gradient(135deg, #86D2F4, #8780FF);
            color: white;
            border: none;
            padding: 10px 30px;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .oge-understand-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(134, 210, 244, 0.3);
        }
    `;
    document.head.appendChild(style);
}

// –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è
function toggleSolution(taskId, showOnly = false) {
    const solution = document.getElementById(`solution-${taskId}`);
    if (!solution) return;
    
    const btn = document.querySelector(`[data-task="${taskId}"].oge-solution-btn`);
    
    if (showOnly || solution.style.display === 'none' || !solution.style.display) {
        solution.style.display = 'block';
        solution.classList.add('show');
        if (btn) {
            btn.innerHTML = '<i class="bi bi-chevron-up"></i> –°–∫—Ä—ã—Ç—å —Ä–µ—à–µ–Ω–∏–µ';
        }
    } else if (!showOnly) {
        solution.style.display = 'none';
        solution.classList.remove('show');
        if (btn) {
            btn.innerHTML = '<i class="bi bi-journal-text"></i> –†–µ—à–µ–Ω–∏–µ';
        }
    }
}

// –ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç
function showAnswer(taskId) {
    const [workId, taskNum] = taskId.split('-');
    const task = worksDatabase[workId]?.[taskNum - 1];
    if (!task) return;
    
    const feedback = document.getElementById(`feedback-${taskId}`);
    if (!feedback) return;
    
    feedback.innerHTML = `
        <div class="answer-feedback">
            <i class="bi bi-eye-fill"></i>
            <strong>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç:</strong> ${task.a}
        </div>
    `;
    feedback.className = 'oge-feedback info';
}

// –û–ë–ù–û–í–õ–ï–ù–ò–ï: –£–±—Ä–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è showCongratulations

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
function updateStats() {
    let total = 0, solved = 0;
    
    // –°—á–∏—Ç–∞–µ–º —Ä–µ—à–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
    Object.keys(userState.solved).forEach(workId => {
        Object.keys(userState.solved[workId]).forEach(taskId => {
            total++;
            if (userState.solved[workId][taskId] === true) {
                solved++;
            }
        });
    });
    
    // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á: 10 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ √ó 25 –∑–∞–¥–∞—á
    const totalTasks = 10 * 25;
    const percent = totalTasks > 0 ? Math.round((solved / totalTasks) * 100) : 0;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã
    const solvedElement = document.getElementById('solved-count');
    const totalElement = document.getElementById('total-count');
    const progressElement = document.getElementById('progress-percent');
    
    if (solvedElement) solvedElement.textContent = solved;
    if (totalElement) totalElement.textContent = totalTasks;
    if (progressElement) progressElement.textContent = `${percent}%`;
}

// –°–±—Ä–æ—Å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
function resetProgress() {
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –û–ì–≠? –í—Å–µ –≤–∞—à–∏ –æ—Ç–≤–µ—Ç—ã –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.')) {
        userState.solved = {};
        userState.currentWork = 1;
        saveUserState();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º UI
        createWorkFilter();
        loadWork(1);
        updateStats();
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
        showAlert('–ü—Ä–æ–≥—Ä–µ—Å—Å —Å–±—Ä–æ—à–µ–Ω! –í—Å–µ –æ—Ç–≤–µ—Ç—ã —É–¥–∞–ª–µ–Ω—ã.', 'info');
    }
}

// –ü–æ–∫–∞–∑–∞—Ç—å –∞–ª–µ—Ä—Ç
function showAlert(message, type = 'info') {
    const alertDiv = document.createElement('div');
    alertDiv.className = `oge-alert oge-alert-${type}`;
    alertDiv.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 25px;
        border-radius: 15px;
        color: white;
        font-weight: bold;
        z-index: 9999;
        animation: ogeSlideInRight 0.5s ease, ogeFadeOut 0.5s ease 2.5s forwards;
    `;
    
    const bgColor = type === 'info' ? '#17a2b8' : type === 'success' ? '#28a745' : '#dc3545';
    alertDiv.style.background = bgColor;
    
    alertDiv.innerHTML = `
        <i class="bi bi-info-circle me-2"></i>
        ${message}
    `;
    
    document.body.appendChild(alertDiv);
    
    setTimeout(() => {
        if (alertDiv.parentNode) {
            document.body.removeChild(alertDiv);
        }
    }, 3000);
}

// –û—Ç–∫—Ä—ã—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
function openImage(src) {
    const modalImg = document.getElementById('modalImg');
    if (modalImg) {
        modalImg.src = src;
        const modal = new bootstrap.Modal(document.getElementById('imageModal'));
        modal.show();
    }
}